<!-- src/main/resources/templates/register.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Employment Exchange | Register</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-purple-100 to-indigo-100 flex justify-center items-center min-h-screen font-[Inter]">
  <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-md">
    <h2 class="text-3xl font-bold text-center text-indigo-600 mb-6">Create your account</h2>

    <form id="registerForm" th:action="@{/user/register}" method="post" class="space-y-4" th:object="${user}">
      <!-- Hidden autogenerated ID -->
      <input type="hidden" id="userId" th:field="*{userId}" />

      <!-- Avatar -->
      <div id="photoContainer" class="flex justify-center items-center">
        <img th:if="${photoUrl}" th:src="${photoUrl}" alt="Profile"
             class="rounded-full w-24 h-24 border-2 border-indigo-400 object-cover" />
      </div>

      <!-- Upload picture optional -->
      <div class="flex justify-center">
        <label class="mt-2 text-sm text-indigo-600 hover:underline cursor-pointer">
          <input id="photoInput" type="file" accept="image/*" class="hidden" />
          Upload photo
        </label>
      </div>

      <!-- Name -->
      <div>
        <label class="block text-gray-700 mb-1">Full Name</label>
        <input type="text" id="name" th:value="${name}"
               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400"
               placeholder="Full Name" th:readonly="${fromGoogle}" required />
      </div>

      <!-- Role -->
      <div>
        <label class="block text-gray-700 mb-1">Role</label>
        <select id="role" th:field="*{role}"
          class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400" required>
    <option value="" disabled
            th:selected="${#strings.isEmpty(user.role)}">Select role</option>
    <option value="ADMIN">Admin</option>
    <option value="JOB_SEEKER">Job Seeker</option>
    <option value="EMPLOYEE">Employee</option>
  </select>
        <p class="text-xs text-gray-500 mt-1">User ID will be auto-generated based on role. [A####, J####, E####]</p>
      </div>

      <!-- Email -->
     <div>
  <label class="block text-gray-700 mb-1">Email</label>
  <input type="email"
           
         id="email"           
         class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400"
         placeholder="Email"
         th:value="${email}"
       
         th:readonly="${fromGoogle}"
         required />
         <input type="hidden" id="emailHidden" th:field="*{email}" name="email" />
</div>

      <!-- Password -->
      <div>
        <label class="block text-gray-700 mb-1">Password</label>
        <input type="password" id="password"
              th:field="*{password}"
               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400"
               placeholder="Password" required />
        <!-- Strength Meter -->
        <div class="mt-2">
          <div class="w-full bg-gray-200 rounded h-2">
            <div id="strengthBar" class="h-2 rounded bg-red-500 w-0"></div>
          </div>
          <p id="strengthLabel" class="text-sm mt-1 text-gray-700">Strength: —</p>
        </div>
      </div>

      <!-- Confirm -->
      <div>
        <label class="block text-gray-700 mb-1">Confirm Password</label>
        <input type="password" id="confirmPassword"
               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400"
               placeholder="Confirm Password" required />
      </div>

      <p id="errorMsg" class="text-red-600 text-sm hidden">Passwords do not match or are too weak.</p>

      <button type="submit"
              class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition">
        Register
      </button>

      <!-- Google sign-up -->
      <div class="mt-4">
        <button type="button" id="googleSignIn"
                class="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg transition">
          Sign up with Google
        </button>
      </div>
    </form>

    <p class="text-center text-gray-600 mt-6">
      Already have an account?
      <a th:href="@{/login}" class="text-indigo-600 hover:underline">Login</a>
    </p>
  </div>

<script>
  // Helpers
  const photoContainer = document.getElementById('photoContainer');
  const photoInput = document.getElementById('photoInput');
  const nameEl = document.getElementById('name');
  const roleEl = document.getElementById('role');
  const userIdEl = document.getElementById('userId'); // kept in case server sets it
  const emailEl = document.getElementById('email');
  const form = document.getElementById('registerForm');
  const errorMsg = document.getElementById('errorMsg');

  // Create circular initials avatar (Tailwind rounded-full + equal w/h). [web:45][web:42]
  function createInitialAvatar(name) {
    const colors = ["#F87171","#60A5FA","#34D399","#FBBF24","#A78BFA","#F472B6","#2DD4BF"];
    const avatar = document.createElement('div');
    avatar.textContent = (name || '?').trim().charAt(0).toUpperCase() || '?';
    avatar.className = "flex items-center justify-center rounded-full w-24 h-24 text-white font-bold text-2xl border-2 border-indigo-400";
    avatar.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
    return avatar;
  }

  function setAvatarFromName() {
    if (document.querySelector('#photoContainer img')) return;
    photoContainer.innerHTML = "";
    photoContainer.appendChild(createInitialAvatar(nameEl.value));
  } // Initials fallback is a common avatar pattern. [web:45][web:42]

  nameEl.addEventListener('blur', () => {
    if (nameEl.value.trim()) setAvatarFromName();
  });

  // Optional local preview for uploaded photo
  photoInput.addEventListener('change', (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      photoContainer.innerHTML = "";
      const img = document.createElement('img');
      img.src = reader.result;
      img.alt = "Profile";
      img.className = "rounded-full w-24 h-24 border-2 border-indigo-400 object-cover";
      photoContainer.appendChild(img);
    };
    reader.readAsDataURL(file);
  }); // object-cover keeps the image inside the circle. [web:45][web:42]

  // Password strength meter (length + character variety)
  const strengthBar = document.getElementById('strengthBar');
  const strengthLabel = document.getElementById('strengthLabel');
  function passwordScore(pw) {
    let score = 0;
    if (pw.length >= 8) score++;
    if (/[a-z]/.test(pw)) score++;
    if (/[A-Z]/.test(pw)) score++;
    if (/\d/.test(pw)) score++;
    if (/[@.#$!%^&*?_+-]/.test(pw)) score++;
    return Math.min(score, 5);
  } // Standard strength criteria. [web:49][web:43]

  function updateStrengthUI(pw) {
    const score = passwordScore(pw);
    const widths = ['0%','20%','40%','60%','80%','100%'];
    const colors = ['bg-red-500','bg-red-500','bg-orange-500','bg-yellow-500','bg-green-500','bg-green-600'];
    strengthBar.className = `h-2 rounded ${colors[score]}`;
    strengthBar.style.width = widths[score];
    const labels = ['—','Very Weak','Weak','Medium','Strong','Very Strong'];
    strengthLabel.textContent = `Strength: ${labels[score]}`;
    return score;
  } // Improves UX. [web:41]

  const pwdEl = document.getElementById('password');
  const cpwEl = document.getElementById('confirmPassword');
  pwdEl.addEventListener('input', () => updateStrengthUI(pwdEl.value));

  // Form submit validation
  form.addEventListener('submit', (e) => {
    const score = updateStrengthUI(pwdEl.value);
    const matches = pwdEl.value === cpwEl.value;
    if (!matches || score < 3) { // require at least "Medium"
      e.preventDefault();
      errorMsg.classList.remove('hidden');
    } else {
      errorMsg.classList.add('hidden');
    }
  }); // Keep validation; no userId manipulation here. [web:25][web:29]

  // Google OAuth2 sign-up
  document.getElementById('googleSignIn').addEventListener('click', () => {
    window.location.href = "/oauth2/authorization/google";
  }); // Redirect to OAuth2 endpoint. [web:25]

  // Initial avatar on load if no image present
  window.addEventListener('DOMContentLoaded', () => {
    const hasImg = document.querySelector('#photoContainer img');
    if (!hasImg && nameEl.value.trim()) setAvatarFromName();
  });
</script>

</body>
</html>
